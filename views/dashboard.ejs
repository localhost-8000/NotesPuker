<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>AncoreNotes</title>
  <link rel="icon" href="/images/o1.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600&display=swap"
    rel="stylesheet">
  <!-- plugins:css -->
  <link rel="stylesheet" href="/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/vendors/base/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- plugin css for this page -->
  <link rel="stylesheet" href="/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->

  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <link rel="stylesheet" href="/pages_css/dashboard.css">
  <%- include('partials/header'); -%>
  <!-- endinject -->
  <!-- <link rel="shortcut icon" href="images/favicon.png" /> -->
  <style>
    .profileUrl {
      color: black;
      text-decoration: underline;
    }

    .profileUrl:hover {
      color: black;
    }
  </style>

<%- include('partials/header'); -%>


</head>

<body>
  <div class="container-scroller font-class">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">

      <!-- Name and Logo Section -->
      <%- include('partials/_name_logo'); -%>


        <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end box-shadow-nav">

          <ul class="navbar-nav navbar-nav-right">

            <!--User Profile Section -->
            <%- include('partials/_userProfileSection', {authorProfile: authorProfile}); -%>

          </ul>

          <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
            data-toggle="offcanvas">
            <span class="mdi mdi-menu"></span>
          </button>

        </div>

    </nav>



    <!-- partial -->
    <div class="container-fluid page-body-wrapper px-0">

      <!-- SideBar -->
      <!-- partial:partials/_sidebar.html -->
      <%- include('partials/_sidebar'); -%>

        <!-- Main Panel Home  -->
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper pageWrapperP homeBg">

            <!-- Home Top/ Welcome and all -->
            <div class="dashboard__main">

              <div class="card dashboard__top box-shadow-1">
                <h1 class="">Welcome to <%= college %>
                </h1>
                <h5 class="">To share and download your pdfs and notes, navigate to navbar.</h5>
              </div>

              <div class="card dashboard__topContributer box-shadow-2">
                <h4 class="dashboard__h4head">Top Contributers</h4>
                <table class="table table-bordered">
                  <tbody>
                    <% if(arr.length===0) { %>
                      <h3 class="">No user has started uploading notes!</h3>
                      <% } else { %>
                        <% for(let i=0; i < arr.length; i++) { %>
                          <tr>
                            <th scope="row">
                              <%= i + 1 %>
                            </th>
                            <td><a class="profileUrl" href="/profile/<%= arr[i].id %>">
                                <%= arr[i].name %>
                              </a></td>
                            <td>
                              <%= arr[i].pdfLength %> uploads
                            </td>
                          </tr>
                          <% } %>
                            <% } %>
                  </tbody>
                </table>
              </div>

              <div id="form" data-aos="zoom-in-up" class="card dashboard__uploadForm box-shadow-2">
                <h4 class="p-2 text-center dashboard__h4head">Share your notes below</h4>
                <div class="p-3">

                  <form id="uploadForm" name="my-form" class="forms-sample" action="/dashboard/uploadfile"
                    method="POST">
                    <div class="form-group">
                      <input type="text" name="title" class="form-control" id="exampleInputUsername1"
                        placeholder="Enter a suitable title for your upload." autocomplete="off" required>
                    </div>
                    <div class="form-group">
                      <input type="text" name="driveUrl" class="form-control" id="exampleInputEmail1"
                        placeholder="Google Drive Shareable link" autocomplete="off" required>
                    </div>
                    <div class="category__uploadFormBottom">
                      <div class="form-group w-100 mr-2">
                        <label for="exampleFormControlSelect1">Year</label>
                        <select name="year" class="form-control" id="exampleFormControlSelect1" required>
                          <option>1</option>
                          <option>2</option>
                          <option>3</option>
                          <option>4</option>
                          <option>5</option>
          

                        </select>
                      </div>
                      <div class="form-group w-100 ml-2">
                        <label for="exampleFormControlSelect1">Branch</label>
                        <select name="branch" class="form-control" id="exampleFormControlSelect1" required>
                          <option>BioTech Engineering</option>
                          <option>Civil Engineering</option>
                          <option>Computer Science And Engineering</option>
                          <option>Chemical Engineering</option>
                          <option>Electrical Engineering</option>
                          <option>Electronics And Communication Engineering</option>
                          <option>Mechanical Engineering</option>
                          <option>Production Engineering</option>
                          <option>Electronics And Instrumation Engineering</option>
                          <option>Bsms Physics</option>
                          <option>Bsms Chemistry</option>
                          <option>Mathematics And Computing</option>
                          <option>Engineering Physics</option>
                        </select>
                      </div>

                    </div>

                    <div class="card category__upload">
                      <button id="pop-btn" type="submit" class="btn btn-danger btn-icon-text">
                        <i class="mdi mdi-upload btn-icon-prepend"></i>
                        Upload your file
                      </button>
                    </div>
                  </form>
                </div>
                <h5 class="p-2 text-center dashboard__h4head">Tutorial to get drive link</h5>
                <div class="dashboard__video">
                  
                  <video class="" controls>
                    <source src="/videos/FileUpload.mp4" type="video/mp4">
                  </video>
                </div>
              </div>



              <!-- <div class="card dashboard__collegeQuora">
              <h4>NIT Agartala Quora</h4>
              <div class="dashboard__quoraInputQuestion">
                <form action="" class="d-flex">
                  <input type="text" class="form-control" id="exampleFormControlInput1"
                    placeholder="What is your question?" autocomplete="off">
                  <button type="submit" class="btn btn-secondary">Post</button>
                </form>
              </div>

              <hr>

              <div class="dashboard__questions">
                <h5>This is the example Question?</h5>
              </div>

            </div> -->

            </div>


          </div>
          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.html -->
          <footer class="footer">
            <div class="d-sm-flex justify-content-center justify-content-sm-between">
              <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Copyright Â© AncoreNotes</span>
            </div>
          </footer>
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <script src="/vendors/base/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <script src="/vendors/chart.js/Chart.min.js"></script>
  <script src="/vendors/datatables.net/jquery.dataTables.js"></script>
  <script src="/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script src="/js/off-canvas.js"></script>
  <script src="/js/hoverable-collapse.js"></script>
  <script src="/js/template.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="/js/dashboard.js"></script>
  <script src="/js/data-table.js"></script>
  <script src="/js/jquery.dataTables.js"></script>
  <script src="/js/dataTables.bootstrap4.js"></script>
  <!-- End custom js for this page-->
  <script src="/js/jquery.cookie.js" type="text/javascript"></script>


  <!-- jQuery for uploading pdf  -->
  <script>
    function isValidURL(url) {
      var res = url.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%.\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%\+.~#?&//=]*)/g);
      return (res !== null)
    };

    const isValidDriveUrl = (driveUrl) => {
        const urlPattern = /https:\/\/drive.google.com\/file\/d\/[a-zA-Z0-9_-]*\/view\?usp=[a-z]*/
        const matched = driveUrl.match(urlPattern)
        return (matched != null) ? true : false;
    }

    $("#uploadForm").on("submit", (e) => {
      e.preventDefault();

      const driveUrl = $("#exampleInputEmail1").val();
      console.log(driveUrl);
      if (isValidDriveUrl(driveUrl) && isValidURL(driveUrl)) {
        $.ajax({
          data: $("#uploadForm").serialize(),
          type: 'post',
          url: "/dashboard",
          success: (result) => {
            // console.log(result.status);
            alert("Your notes has been uploaded successfully. Thank you for your contribution.")
            document.forms["my-form"].reset();
          },
          error: (err) => {
            alert("Some error occured while uploading your notes. Sorry for inconvenience !")
            document.forms["my-form"].reset();
          }
        });
      }
      else {
        alert("Given drive url is not a valid url. Enter correct url.");
        $("#exampleInputEmail1").val('');
      }
    })
  </script>

  <!-- bootstrap script -->

</body>

</html>
